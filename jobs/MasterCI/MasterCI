node{
    deleteDir()
    checkout scm
    def shareMethod = load("jobs/ShareMethod.groovy")
    try{

        def repo_dir = pwd()
        def TESTS = "${env.TESTS}"
        // Create an instance of UnitTest/UnitTest.groovy
        def unit_test = load("jobs/UnitTest/UnitTest.groovy")
        // Create an instance of FunctionTest/FunctionTest.groovy
        def function_test = load("jobs/FunctionTest/FunctionTest.groovy")

        try{
            stage("Unit Test"){
                // Call the function runTest to run unit test
                //unit_test.runTest(env.stash_manifest_name, env.stash_manifest_path, repo_dir)
            }
            stage("Function Test"){
                // Call the function run to run function test
                //function_test.manifestTest(TESTS, env.stash_manifest_name, env.stash_manifest_path, repo_dir)
            }
        } finally{
            unit_test.archiveArtifactsToTarget("UnitTest")
            function_test.archiveArtifactsToTarget("FunctionTest")
        }
        shareMethod.buildAndPublish()
    } finally{
        shareMethod.sendResult(true, true)
    }
}
